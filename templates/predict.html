{% extends "base.html" %} {% block content %}
<div class="d-flex justify-content-center mt-5">
  <div class="card shadow-sm p-4" style="width: 100%; max-width: 600px">
    <h2 class="text-center mb-4">House Price Prediction</h2>

    <form id="predict-form">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Latitude</label>
          <input
            type="number"
            step="any"
            name="latitude"
            class="form-control"
            required
          />
        </div>
        <div class="col-md-6">
          <label class="form-label">Longitude</label>
          <input
            type="number"
            step="any"
            name="longitude"
            class="form-control"
            required
          />
        </div>
        <div class="col-md-6">
          <label class="form-label">Bathrooms</label>
          <input type="number" name="bathrooms" class="form-control" required />
        </div>
        <div class="col-md-6">
          <label class="form-label">Bedrooms</label>
          <input type="number" name="bedrooms" class="form-control" required />
        </div>
        <div class="col-md-6">
          <label class="form-label">Floor Area (Sq M)</label>
          <input
            type="number"
            name="floorAreaSqM"
            class="form-control"
            required
          />
        </div>
        <div class="col-md-6">
          <label class="form-label">Living Rooms</label>
          <input
            type="number"
            name="livingRooms"
            class="form-control"
            required
          />
        </div>
        <div class="col-md-6">
          <label class="form-label">Tenure</label>
          <select name="tenure" class="form-select" required>
            <option value="Freehold">Freehold</option>
            <option value="Leasehold">Leasehold</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Property Type</label>
          <select name="propertyType" class="form-select" required>
            <option value="Detached House">Detached House</option>
            <option value="Semi-Detached House">Semi-Detached House</option>
            <option value="Terraced House">Terraced House</option>
            <option value="Flat">Flat</option>
            <option value="Bungalow">Bungalow</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Current Energy Rating</label>
          <select name="currentEnergyRating" class="form-select" required>
            {% for rating in ['A','B','C','D','E','F','G'] %}
            <option value="{{ rating }}">{{ rating }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Sale Month</label>
          <input
            type="number"
            name="sale_month"
            min="1"
            max="12"
            class="form-control"
            required
          />
        </div>
        <div class="col-md-3">
          <label class="form-label">Sale Year</label>
          <input
            type="number"
            name="sale_year"
            min="1900"
            max="2100"
            class="form-control"
            required
          />
        </div>
      </div>

      <button type="submit" class="btn btn-warning w-100 mt-4">Predict</button>
    </form>

    <div id="prediction-result" class="mt-4 text-center" style="display: none">
      <h4>Predicted Price: <span id="predicted-price"></span> GBP</h4>
    </div>
  </div>
</div>

<script>
  document
    .getElementById('predict-form')
    .addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const data = {};
      formData.forEach((value, key) => {
        if (['latitude', 'longitude'].includes(key))
          data[key] = parseFloat(value);
        else if (
          [
            'bathrooms',
            'bedrooms',
            'floorAreaSqM',
            'livingRooms',
            'sale_month',
            'sale_year',
          ].includes(key)
        )
          data[key] = parseInt(value, 10);
        else data[key] = value;
      });

      try {
        const response = await fetch('/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        const result = await response.json();

        if (response.ok) {
          document.getElementById('predicted-price').innerText =
            result.predicted_price.toFixed(2);
          document.getElementById('prediction-result').style.display = 'block';
        } else {
          alert('Error: ' + result.error);
          document.getElementById('prediction-result').style.display = 'none';
        }
      } catch (error) {
        alert('Fetch error: ' + error.message);
        document.getElementById('prediction-result').style.display = 'none';
      }
    });
</script>
{% endblock %}
